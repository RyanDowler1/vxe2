{"version":3,"file":"react-collapsed.umd.js","sources":["../src/utils.js","../src/hooks.js","../src/react-collapsed.js"],"sourcesContent":["export const noop = () => {};\n\nexport function getElementHeight(el) {\n  if (!el || !el.current) {\n    return 'auto';\n  }\n  return el.current.scrollHeight;\n}\n\n// Helper function for render props. Sets a function to be called, plus any additional functions passed in\nexport const callAll = (...fns) => (...args) =>\n  fns.forEach(fn => fn && fn(...args));\n\nexport const defaultTransitionStyles = {\n  transitionDuration: '500ms',\n  transitionTimingFunction: 'cubic-bezier(0.250, 0.460, 0.450, 0.940)',\n};\n\nexport function joinTransitionProperties(string) {\n  if (string) {\n    const styles = ['height'];\n    styles.push(...string.split(', '));\n    return styles.join(', ');\n  }\n  return 'height';\n}\n\nexport function makeTransitionStyles({\n  expandStyles = defaultTransitionStyles,\n  collapseStyles = defaultTransitionStyles,\n}) {\n  return {\n    expandStyles: {\n      ...expandStyles,\n      transitionProperty: joinTransitionProperties(\n        expandStyles.transitionProperty\n      ),\n    },\n    collapseStyles: {\n      ...collapseStyles,\n      transitionProperty: joinTransitionProperties(\n        collapseStyles.transitionProperty\n      ),\n    },\n  };\n}\n","import {useState, useRef, useEffect} from 'react';\n\nexport function useStateOrProps({isOpen, defaultOpen}) {\n  const [open, setOpen] = useState(defaultOpen || false);\n  const definedOpen = typeof isOpen !== 'undefined' ? isOpen : open;\n  return [definedOpen, setOpen];\n}\n\nexport function useEffectAfterMount(cb, dependencies) {\n  const justMounted = useRef(true);\n  useEffect(() => {\n    if (!justMounted.current) {\n      return cb();\n    }\n    justMounted.current = false;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n}\n\n// Unique ID implementation borrowed from React UI :)\n// https://github.com/reach/reach-ui/blob/6e9dbcf716d5c9a3420e062e5bac1ac4671d01cb/packages/auto-id/src/index.js\nlet idCounter = 0;\nconst genId = () => ++idCounter;\n\n/**\n * This generates a unique ID for an instance of Collapse\n * @return {String} the unique ID\n */\nexport function useUniqueId() {\n  const [id, setId] = useState(null);\n  useEffect(() => setId(genId()), []);\n  return id;\n}\n","import {useState, useRef, useCallback, useMemo} from 'react';\nimport raf from 'raf';\nimport {\n  callAll,\n  noop,\n  getElementHeight,\n  makeTransitionStyles,\n  joinTransitionProperties,\n  defaultTransitionStyles,\n} from './utils';\nimport {useUniqueId, useEffectAfterMount, useStateOrProps} from './hooks';\n\nexport default function useCollapse(initialConfig = {}) {\n  const uniqueId = useUniqueId();\n  const el = useRef(null);\n  const [isOpen, setOpen] = useStateOrProps(initialConfig);\n  const collapsedHeight = `${initialConfig.collapsedHeight || 0}px`;\n  const collapsedStyles = useMemo(\n    () => ({\n      display: collapsedHeight === '0px' ? 'none' : 'block',\n      height: collapsedHeight,\n      overflow: 'hidden',\n    }),\n    [collapsedHeight]\n  );\n  const {expandStyles, collapseStyles} = useMemo(\n    () => makeTransitionStyles(initialConfig),\n    [initialConfig]\n  );\n  const [styles, setStyles] = useState(isOpen ? {} : collapsedStyles);\n  const [mountChildren, setMountChildren] = useState(isOpen);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const toggleOpen = useCallback(() => setOpen(oldOpen => !oldOpen), []);\n\n  useEffectAfterMount(\n    () => {\n      if (isOpen) {\n        raf(() => {\n          setMountChildren(true);\n          setStyles(oldStyles => ({\n            ...oldStyles,\n            ...expandStyles,\n            willChange: 'height',\n            display: 'block',\n            overflow: 'hidden',\n          }));\n          raf(() => {\n            const height = getElementHeight(el);\n            setStyles(oldStyles => ({...oldStyles, height}));\n          });\n        });\n      } else {\n        raf(() => {\n          const height = getElementHeight(el);\n          setStyles(oldStyles => ({\n            ...oldStyles,\n            ...collapseStyles,\n            willChange: 'height',\n            height,\n          }));\n          raf(() => {\n            setStyles(oldStyles => ({\n              ...oldStyles,\n              height: collapsedHeight,\n              overflow: 'hidden',\n            }));\n          });\n        });\n      }\n    },\n    [isOpen]\n  );\n\n  const handleTransitionEnd = e => {\n    // Sometimes onTransitionEnd is triggered by another transition,\n    // such as a nested collapse panel transitioning. But we only\n    // want to handle this if this component's element is transitioning\n    if (e.target !== el.current) {\n      return;\n    }\n\n    // The height comparisons below are a final check before completing the transition\n    // Sometimes this callback is run even though we've already begun transitioning the other direction\n    // The conditions give us the opportunity to bail out, which will prevent the collapsed content from flashing on the screen\n    if (isOpen) {\n      const height = getElementHeight(el);\n      // If the height at the end of the transition matches the height we're animating to,\n      // it's safe to clear all style overrides\n      if (height === styles.height) {\n        setStyles({});\n      } else {\n        // If the heights don't match, this could be due the height of the content changing mid-transition\n        // If that's the case, re-trigger the animation to animate to the new height\n        setStyles(oldStyles => ({...oldStyles, height}));\n      }\n      // If the height we should be animating to matches the collapsed height,\n      // it's safe to apply the collapsed overrides\n    } else if (styles.height === collapsedHeight) {\n      setMountChildren(false);\n      setStyles(collapsedStyles);\n    }\n  };\n\n  return {\n    getToggleProps(props = {}) {\n      const {disabled = false, onClick = noop, ...rest} = props;\n      return {\n        type: 'button',\n        role: 'button',\n        id: `react-collapsed-toggle-${uniqueId}`,\n        'aria-controls': `react-collapsed-panel-${uniqueId}`,\n        'aria-expanded': isOpen ? 'true' : 'false',\n        tabIndex: 0,\n        ...rest,\n        onClick: disabled ? noop : callAll(onClick, toggleOpen),\n      };\n    },\n    getCollapseProps(props = {}) {\n      const {\n        style = {},\n        onTransitionEnd = noop,\n        refKey = 'ref',\n        ...rest\n      } = props;\n      return {\n        id: `react-collapsed-panel-${uniqueId}`,\n        'aria-hidden': isOpen ? null : 'true',\n        ...rest,\n        [refKey]: el,\n        onTransitionEnd: callAll(handleTransitionEnd, onTransitionEnd),\n        style: {\n          // Default transition duration and timing function, so height will transition\n          // when resting and the height of the collapse changes\n          ...defaultTransitionStyles,\n          // additional styles passed, e.g. getCollapseProps({style: {}})\n          ...style,\n          // combine any additional transition properties with height\n          transitionProperty: joinTransitionProperties(\n            style.transitionProperty\n          ),\n          // style overrides from state\n          ...styles,\n        },\n      };\n    },\n    isOpen,\n    toggleOpen,\n    mountChildren,\n  };\n}\n"],"names":["noop","getElementHeight","el","current","scrollHeight","callAll","fns","args","forEach","fn","defaultTransitionStyles","transitionDuration","transitionTimingFunction","joinTransitionProperties","string","styles","push","split","join","idCounter","genId","cb","dependencies","justMounted","initialConfig","uniqueId","useState","id","setId","useEffect","useUniqueId","useRef","isOpen","defaultOpen","open","useStateOrProps","setOpen","collapsedHeight","collapsedStyles","useMemo","display","height","overflow","expandStyles","collapseStyles","transitionProperty","setStyles","mountChildren","setMountChildren","toggleOpen","useCallback","oldOpen","raf","oldStyles","willChange","handleTransitionEnd","e","target","getToggleProps","props","disabled","onClick","rest","type","role","tabIndex","getCollapseProps","style","onTransitionEnd","refKey"],"mappings":"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"}