{"version":3,"file":"react-collapsed.cjs.js","sources":["../src/utils.js","../src/hooks.js","../src/react-collapsed.js"],"sourcesContent":["export const noop = () => {};\n\nexport function getElementHeight(el) {\n  if (!el || !el.current) {\n    return 'auto';\n  }\n  return el.current.scrollHeight;\n}\n\n// Helper function for render props. Sets a function to be called, plus any additional functions passed in\nexport const callAll = (...fns) => (...args) =>\n  fns.forEach(fn => fn && fn(...args));\n\nexport const defaultTransitionStyles = {\n  transitionDuration: '500ms',\n  transitionTimingFunction: 'cubic-bezier(0.250, 0.460, 0.450, 0.940)',\n};\n\nexport function joinTransitionProperties(string) {\n  if (string) {\n    const styles = ['height'];\n    styles.push(...string.split(', '));\n    return styles.join(', ');\n  }\n  return 'height';\n}\n\nexport function makeTransitionStyles({\n  expandStyles = defaultTransitionStyles,\n  collapseStyles = defaultTransitionStyles,\n}) {\n  return {\n    expandStyles: {\n      ...expandStyles,\n      transitionProperty: joinTransitionProperties(\n        expandStyles.transitionProperty\n      ),\n    },\n    collapseStyles: {\n      ...collapseStyles,\n      transitionProperty: joinTransitionProperties(\n        collapseStyles.transitionProperty\n      ),\n    },\n  };\n}\n","import {useState, useRef, useEffect} from 'react';\n\nexport function useStateOrProps({isOpen, defaultOpen}) {\n  const [open, setOpen] = useState(defaultOpen || false);\n  const definedOpen = typeof isOpen !== 'undefined' ? isOpen : open;\n  return [definedOpen, setOpen];\n}\n\nexport function useEffectAfterMount(cb, dependencies) {\n  const justMounted = useRef(true);\n  useEffect(() => {\n    if (!justMounted.current) {\n      return cb();\n    }\n    justMounted.current = false;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n}\n\n// Unique ID implementation borrowed from React UI :)\n// https://github.com/reach/reach-ui/blob/6e9dbcf716d5c9a3420e062e5bac1ac4671d01cb/packages/auto-id/src/index.js\nlet idCounter = 0;\nconst genId = () => ++idCounter;\n\n/**\n * This generates a unique ID for an instance of Collapse\n * @return {String} the unique ID\n */\nexport function useUniqueId() {\n  const [id, setId] = useState(null);\n  useEffect(() => setId(genId()), []);\n  return id;\n}\n","import {useState, useRef, useCallback, useMemo} from 'react';\nimport raf from 'raf';\nimport {\n  callAll,\n  noop,\n  getElementHeight,\n  makeTransitionStyles,\n  joinTransitionProperties,\n  defaultTransitionStyles,\n} from './utils';\nimport {useUniqueId, useEffectAfterMount, useStateOrProps} from './hooks';\n\nexport default function useCollapse(initialConfig = {}) {\n  const uniqueId = useUniqueId();\n  const el = useRef(null);\n  const [isOpen, setOpen] = useStateOrProps(initialConfig);\n  const collapsedHeight = `${initialConfig.collapsedHeight || 0}px`;\n  const collapsedStyles = useMemo(\n    () => ({\n      display: collapsedHeight === '0px' ? 'none' : 'block',\n      height: collapsedHeight,\n      overflow: 'hidden',\n    }),\n    [collapsedHeight]\n  );\n  const {expandStyles, collapseStyles} = useMemo(\n    () => makeTransitionStyles(initialConfig),\n    [initialConfig]\n  );\n  const [styles, setStyles] = useState(isOpen ? {} : collapsedStyles);\n  const [mountChildren, setMountChildren] = useState(isOpen);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const toggleOpen = useCallback(() => setOpen(oldOpen => !oldOpen), []);\n\n  useEffectAfterMount(\n    () => {\n      if (isOpen) {\n        raf(() => {\n          setMountChildren(true);\n          setStyles(oldStyles => ({\n            ...oldStyles,\n            ...expandStyles,\n            willChange: 'height',\n            display: 'block',\n            overflow: 'hidden',\n          }));\n          raf(() => {\n            const height = getElementHeight(el);\n            setStyles(oldStyles => ({...oldStyles, height}));\n          });\n        });\n      } else {\n        raf(() => {\n          const height = getElementHeight(el);\n          setStyles(oldStyles => ({\n            ...oldStyles,\n            ...collapseStyles,\n            willChange: 'height',\n            height,\n          }));\n          raf(() => {\n            setStyles(oldStyles => ({\n              ...oldStyles,\n              height: collapsedHeight,\n              overflow: 'hidden',\n            }));\n          });\n        });\n      }\n    },\n    [isOpen]\n  );\n\n  const handleTransitionEnd = e => {\n    // Sometimes onTransitionEnd is triggered by another transition,\n    // such as a nested collapse panel transitioning. But we only\n    // want to handle this if this component's element is transitioning\n    if (e.target !== el.current) {\n      return;\n    }\n\n    // The height comparisons below are a final check before completing the transition\n    // Sometimes this callback is run even though we've already begun transitioning the other direction\n    // The conditions give us the opportunity to bail out, which will prevent the collapsed content from flashing on the screen\n    if (isOpen) {\n      const height = getElementHeight(el);\n      // If the height at the end of the transition matches the height we're animating to,\n      // it's safe to clear all style overrides\n      if (height === styles.height) {\n        setStyles({});\n      } else {\n        // If the heights don't match, this could be due the height of the content changing mid-transition\n        // If that's the case, re-trigger the animation to animate to the new height\n        setStyles(oldStyles => ({...oldStyles, height}));\n      }\n      // If the height we should be animating to matches the collapsed height,\n      // it's safe to apply the collapsed overrides\n    } else if (styles.height === collapsedHeight) {\n      setMountChildren(false);\n      setStyles(collapsedStyles);\n    }\n  };\n\n  return {\n    getToggleProps(props = {}) {\n      const {disabled = false, onClick = noop, ...rest} = props;\n      return {\n        type: 'button',\n        role: 'button',\n        id: `react-collapsed-toggle-${uniqueId}`,\n        'aria-controls': `react-collapsed-panel-${uniqueId}`,\n        'aria-expanded': isOpen ? 'true' : 'false',\n        tabIndex: 0,\n        ...rest,\n        onClick: disabled ? noop : callAll(onClick, toggleOpen),\n      };\n    },\n    getCollapseProps(props = {}) {\n      const {\n        style = {},\n        onTransitionEnd = noop,\n        refKey = 'ref',\n        ...rest\n      } = props;\n      return {\n        id: `react-collapsed-panel-${uniqueId}`,\n        'aria-hidden': isOpen ? null : 'true',\n        ...rest,\n        [refKey]: el,\n        onTransitionEnd: callAll(handleTransitionEnd, onTransitionEnd),\n        style: {\n          // Default transition duration and timing function, so height will transition\n          // when resting and the height of the collapse changes\n          ...defaultTransitionStyles,\n          // additional styles passed, e.g. getCollapseProps({style: {}})\n          ...style,\n          // combine any additional transition properties with height\n          transitionProperty: joinTransitionProperties(\n            style.transitionProperty\n          ),\n          // style overrides from state\n          ...styles,\n        },\n      };\n    },\n    isOpen,\n    toggleOpen,\n    mountChildren,\n  };\n}\n"],"names":["noop","getElementHeight","el","current","scrollHeight","callAll","fns","args","forEach","fn","defaultTransitionStyles","transitionDuration","transitionTimingFunction","joinTransitionProperties","string","styles","push","split","join","makeTransitionStyles","expandStyles","collapseStyles","transitionProperty","useStateOrProps","isOpen","defaultOpen","useState","open","useEffectAfterMount","cb","dependencies","justMounted","useRef","useEffect","idCounter","genId","useUniqueId","id","setId","useCollapse","initialConfig","uniqueId","setOpen","collapsedHeight","collapsedStyles","useMemo","display","height","overflow","setStyles","mountChildren","setMountChildren","toggleOpen","useCallback","oldOpen","raf","oldStyles","willChange","handleTransitionEnd","e","target","getToggleProps","props","disabled","onClick","rest","type","role","tabIndex","getCollapseProps","style","onTransitionEnd","refKey"],"mappings":"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"}